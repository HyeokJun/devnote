extends layout

// BODY
block content
  urlToWiki  = joinPath('/wikis', wikiName)
  urlToPages = joinPath('/wikis', wikiName, 'pages')
  urlToPage  = joinPath('/wikis', wikiName, 'pages', title)

  if page.isOld
    div.alert.alert-info!= __("This is an old revision of this page, as edited by %s at %s. It may differ significantly from the <a href='%s'>current revision</a>.", page.commit.author.name, new Date(page.commit.author.unixtime * 100), urlToPage)

  if lastVisit
    urlToDiffSinceLastVisit = urlToPage + '?action=diff&a=' + lastVisit.id + '&b=' + page.commitId
    div.alert.alert-info!= __("Something changed since your last visit, %s. <a href='%s'>Click here</a> to see the difference.", lastVisit.date, urlToDiffSinceLastVisit)

  div.row.pull-right
    div.span3
      a(href='#{urlToPage}?action=edit').btn.btn-primary= __('Edit')
      a(href='#{urlToWiki}/new').btn= __('New')
      a(href='#{urlToPage}?action=history').btn= __('History')
    div.span1
      form(method="post", action=urlToPage)
        input(type="hidden", name="_method", id='_method', value="delete")
        input(type="submit", value=__('Delete'), name="submit").btn
    div.span1
      if loggedIn
        form(method="post", action='#{urlToWiki}/subscribes/#{title}')
          if subscribed
            input(type="hidden", name="_method", id="_method", value="delete")
            input(type="submit", value=__('Unsubscribe'), name="submit").btn
          else
            input(type="hidden", name="_method", id="_method", value="put")
            input(type="submit", value=__('Subscribe'), name="submit").btn

  section(id="content", tabindex="0").nBody
    article.article
      hgroup.page-header
        h1= title
      // Text
      article.tx
        != content

  script(type="text/javascript", src="/scripts/jquery.js")
  script(type="text/javascript", src="/scripts/keynavi.js")
  script(type="text/javascript")
    activateEditKey();
    activateNewKey('#{urlToWiki}/new');
